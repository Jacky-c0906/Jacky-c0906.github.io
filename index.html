<!doctype html><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Jacky 的音乐软件展示</title><h1>Hello, GitHub Pages!</h1>
<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>音乐库 · 自动读取 tracks.json</title>
  <style>
    :root { color-scheme: light dark; --bg:#fff; --fg:#111; --muted:#666; --pri:#2563eb; }
    @media (prefers-color-scheme: dark){
      :root { --bg:#0b0f14; --fg:#e5e7eb; --muted:#9ca3af; --pri:#60a5fa; }
    }
    html,body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";line-height:1.5}
    header{position:sticky;top:0;z-index:10;background:var(--bg);border-bottom:1px solid rgba(127,127,127,.2)}
    .wrap{max-width:1100px;margin:auto;padding:12px 16px}
    h1{font-size:20px;margin:6px 0}
    .grid{display:grid;grid-template-columns:260px 1fr;gap:16px}
    @media (max-width:820px){ .grid{grid-template-columns:1fr} }
    .panel{border:1px solid rgba(127,127,127,.2);border-radius:10px;overflow:hidden}
    .panel h2{margin:0;font-size:16px;padding:10px 12px;border-bottom:1px solid rgba(127,127,127,.15);background:rgba(127,127,127,.06)}
    .list{max-height:58vh;overflow:auto}
    .list button{all:unset;display:block;width:100%;padding:10px 12px;border-bottom:1px solid rgba(127,127,127,.08);cursor:pointer}
    .list button:hover{background:rgba(37,99,235,.08)}
    .now{padding:10px 12px;font-size:14px;color:var(--muted)}
    .badge{display:inline-block;min-width:1.5em;text-align:center;padding:.1em .5em;border-radius:999px;background:rgba(37,99,235,.15);color:var(--pri);font-size:12px;margin-left:.5em}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .chip{border:1px solid rgba(127,127,127,.3);padding:6px 10px;border-radius:999px;cursor:pointer}
    .chip.active,.chip:hover{background:rgba(37,99,235,.12);border-color:var(--pri);color:var(--pri)}
    footer{padding:14px 0;color:var(--muted);font-size:12px}
    audio{width:100%}
    .empty{padding:12px;color:var(--muted)}
    .search{width:100%;box-sizing:border-box;padding:8px 10px;border:1px solid rgba(127,127,127,.3);border-radius:8px;margin:10px}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>音乐库</h1>
      <div class="row" id="filters"></div>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <section class="panel">
        <h2>曲目</h2>
        <input id="q" class="search" placeholder="搜索标题或路径…" />
        <div class="list" id="trackList"></div>
        <div class="empty" id="emptyMsg" style="display:none">暂无曲目</div>
      </section>

      <section class="panel">
        <h2>播放器</h2>
        <div class="now" id="nowPlaying">未选择曲目</div>
        <audio id="player" controls preload="none"></audio>
      </section>
    </div>
    <footer>提示：Actions 会自动更新 data/tracks.json；本页自动读取并播放。</footer>
  </main>

  <script>
    let allTracks = [];
    let currentGroup = "全部";

    const filtersEl = document.getElementById("filters");
    const listEl = document.getElementById("trackList");
    const emptyMsg = document.getElementById("emptyMsg");
    const player = document.getElementById("player");
    const now = document.getElementById("nowPlaying");
    const q = document.getElementById("q");

    async function load() {
      try {
        const res = await fetch("data/tracks.json?ts=" + Date.now());
        if (!res.ok) throw new Error("加载 tracks.json 失败");
        allTracks = await res.json();
        renderFilters();
        renderList();
      } catch (e) {
        emptyMsg.style.display = "block";
        emptyMsg.textContent = "加载 data/tracks.json 失败：" + e.message;
      }
    }

    function renderFilters(){
      const groups = ["全部", ...[...new Set(allTracks.map(t => t.group))].sort((a,b)=>a.localeCompare(b,"zh"))];
      filtersEl.innerHTML = "";
      groups.forEach(g=>{
        const s = document.createElement("span");
        s.textContent = g;
        s.className = "chip" + (currentGroup===g?" active":"");
        s.onclick = ()=>{ currentGroup=g; renderFilters(); renderList(); };
        filtersEl.appendChild(s);
      });
    }

    function renderList(){
      let data = [...allTracks];
      if(currentGroup!=="全部") data = data.filter(t=>t.group===currentGroup);
      const keyword = q.value?.trim();
      if(keyword) {
        const k = keyword.toLowerCase();
        data = data.filter(t => (t.title||"").toLowerCase().includes(k) || (t.path||"").toLowerCase().includes(k));
      }

      listEl.innerHTML = "";
      if(data.length===0){ emptyMsg.style.display="block"; return; }
      emptyMsg.style.display="none";

      data.forEach(t=>{
        const btn = document.createElement("button");
        btn.innerHTML = `${t.title || t.path} <span class="badge">播放</span>`;
        btn.title = t.path + " · " + (t.group||"");
        btn.onclick = ()=> play(t);
        listEl.appendChild(btn);
      });
    }

    function play(t){
      // 处理中文、空格和+号
      player.src = encodeURI(t.path);
      player.play().catch(()=>{});
      now.textContent = "正在播放： " + (t.title || "") + "  (" + t.path + ")";
    }

    q.addEventListener("input", renderList);

    load();
  </script>
</body>
</html>
